<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Froedtert ThedaCare PTO</title>
    <style>
        /* --- BRANDING --- */
        :root {
            --brand-yellow: #fdc628;
            --brand-black: #000000;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --success-color: #4caf50;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0; 
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        #app-container {
            width: 100%;
            max-width: 400px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            min-height: 550px;
        }

        /* VIEWS */
        .view { display: none; padding: 20px; }
        .view.active { display: block; animation: fade-in 0.3s; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        /* TYPOGRAPHY */
        h2 { margin: 0 0 20px 0; color: var(--brand-black); font-size: 22px; }
        h3 { font-size: 16px; margin: 0 0 10px 0; font-weight: 600; }

        /* BUTTONS */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            /* Force button to be clickable */
            position: relative; 
            z-index: 100;
        }
        .btn-primary { background-color: var(--brand-yellow); color: var(--brand-black); }
        .btn-text { background: transparent; color: #666; margin-top: 5px; }

        /* FORM */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 12px; color: #666; margin-bottom: 5px; }
        .form-control {
            width: 100%; padding: 12px; border: 1px solid #ccc;
            border-radius: 6px; font-size: 16px; box-sizing: border-box;
        }

        /* BALANCE */
        .balance-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }

        /* SPINNER */
        #loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); display: none;
            justify-content: center; align-items: center; z-index: 200;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #eee;
            border-top: 4px solid var(--brand-yellow); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* SUCCESS */
        .success-icon {
            font-size: 40px; color: var(--success-color);
            background: #e8f5e9; width: 80px; height: 80px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            margin: 0 auto 20px auto;
        }
    </style>
</head>
<body>

<div id="app-container">
    
    <div id="loader"><div class="spinner"></div></div>

    <div id="view-dashboard" class="view active">
        <h2>Time Off</h2>
        <div style="background:#fff; border-radius:12px; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h3>Balance</h3><small style="color:#888;">Days Available</small>
            </div>
            <div class="balance-row">
                <div><span class="dot" style="background:#4caf50;"></span>Vacation</div>
                <div><b>4</b> <small>/10</small></div>
            </div>
            <div class="balance-row">
                <div><span class="dot" style="background:#ff9800;"></span>Sick</div>
                <div><b>8</b> <small>/10</small></div>
            </div>
            <div class="balance-row" style="border:none">
                <div><span class="dot" style="background:#2196f3;"></span>WFH</div>
                <div><b>4</b> <small>/5</small></div>
            </div>
        </div>
        <button id="btn-to-form" class="btn btn-primary">Book time off</button>
    </div>

    <div id="view-form" class="view">
        <h2>Book time off</h2>
        <form id="ptoForm" onsubmit="return false;">
            <div class="form-group">
                <label class="form-label">Leave type</label>
                <select class="form-control"><option>Vacation</option><option>Sick</option></select>
            </div>
            <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" class="form-control" id="leaveDate">
            </div>
            <div class="form-group">
                <label class="form-label">Comment</label>
                <input type="text" class="form-control" placeholder="Optional">
            </div>
        </form>
        <button id="btn-submit" type="button" class="btn btn-primary">Submit Request</button>
        <button id="btn-cancel" type="button" class="btn btn-text">Cancel</button>
    </div>

    <div id="view-success" class="view">
        <div style="text-align:center; padding-top:40px;">
            <div class="success-icon">âœ“</div>
            <h2>Request Submitted</h2>
            <p style="color:#666; margin-bottom:30px;">Your PTO request has been submitted to your manager.</p>
            <button id="btn-done" class="btn btn-primary">Done</button>
        </div>
    </div>
</div>

<script>
    /* IMMEDIATE EXECUTION WRAPPER 
       Ensures code runs even if DOMContentLoaded has already fired.
    */
    (function() {
        // --- 1. Get Elements ---
        var vDash = document.getElementById('view-dashboard');
        var vForm = document.getElementById('view-form');
        var vSuccess = document.getElementById('view-success');
        var loader = document.getElementById('loader');
        
        var btnToForm = document.getElementById('btn-to-form');
        var btnSubmit = document.getElementById('btn-submit');
        var btnCancel = document.getElementById('btn-cancel');
        var btnDone = document.getElementById('btn-done');

        // --- 2. Helper: Switch View ---
        function showView(view) {
            vDash.className = 'view';
            vForm.className = 'view';
            vSuccess.className = 'view';
            view.className = 'view active';
        }

        // --- 3. Event Listeners ---
        
        // Go to Form
        btnToForm.onclick = function() {
            document.getElementById('leaveDate').valueAsDate = new Date();
            showView(vForm);
        };

        // Cancel
        btnCancel.onclick = function() {
            showView(vDash);
        };

        // Done
        btnDone.onclick = function() {
            showView(vDash);
        };

        // --- 4. SUBMIT LOGIC (The Critical Part) ---
        btnSubmit.onclick = async function() {
            
            // A. Show loading spinner
            loader.style.display = 'flex';

            // B. API Configuration
            var url = 'https://app.staffbase.com/api/branch/notifications';
            var token = 'Basic NjgzNjc4ZDVjYTRjODk3MThhZjQxMDRiOl1TT3swcl8yKkRsMlNbcVpRaXY4RSwwKzdZbSE3KChXcVMsXkpZYlN5cTFuTW9FKUY2UyQkLEoqUy5ZRkRCK30=';
            var payload = {
                "accessorIds": ["68362d155187c875bbb106d8"],
                "channels": ["notificationCenter", "push"],
                "content": { "en_US": { "text": "PTO Request has been submitted to your manager" } },
                "icon": { "en_US": { "type": "font", "char": "n" } },
                "image": { "en_US": { "type": "image", "href": "https://www.ukg.com/themes/custom/ukg_theme/logo.svg", "width": 600, "height": 400 } }
            };

            // C. Attempt Fetch - Wrapped in TRY/CATCH to ensure UI updates even if API fails
            try {
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Authorization': token, 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                console.log("API Success");
            } catch (err) {
                console.log("API Blocked/Failed (Expected in Demo): " + err);
            }

            // D. FORCE SUCCESS SCREEN (Wait 1s for effect)
            // This runs regardless of API success or failure
            setTimeout(function() {
                loader.style.display = 'none';
                showView(vSuccess);
            }, 1000);
        };

    })();
</script>

</body>
</html>
